---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from './ThemeToggle.astro';
---

<header-component
	class="group sticky top-4 z-50 mb-12 flex items-center justify-between rounded-xl border border-transparent px-4 py-2 transition-all duration-300"
>
	<a
		class="z-30 text-xl font-medium transition-all duration-300"
		href="/"
		aria-label="Brand"
	>{SITE_TITLE}</a>

	<div class="flex items-center gap-4">
		<nav class="hidden md:flex items-center gap-6">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/about">About</HeaderLink>
		</nav>
		<div class="flex items-center gap-2">
			<ThemeToggle />
			<button
				id="toggleMenu"
				class="md:hidden rounded-md border border-gray-300 dark:border-gray-600 p-1.5 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800"
			>
				<span class="sr-only">Menu</span>
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</div>
	</div>

	<div
		id="mobileMenu"
		class="md:hidden absolute top-14 left-0 right-0 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl opacity-0 invisible transition-all duration-300 overflow-hidden"
	>
		<div class="flex flex-col p-4 gap-2">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/about">About</HeaderLink>
		</div>
	</div>
</header-component>

<script>
	class HeaderComponent extends HTMLElement {
		constructor() {
			super();
		}

		connectedCallback() {
			let prevScrollY = window.scrollY;
			this.classList.toggle('not-top', prevScrollY > 20);

			window.addEventListener('scroll', () => {
				const scrollY = window.scrollY;
				this.classList.toggle('not-top', scrollY > 20);
				this.dataset.show = (scrollY < 350 || scrollY < prevScrollY).toString();
				prevScrollY = scrollY;
			});

			const menuBtn = this.querySelector('#toggleMenu');
			const mobileMenu = this.querySelector('#mobileMenu');

			menuBtn?.addEventListener('click', () => {
				this.classList.toggle('expanded');
				if (this.classList.contains('expanded')) {
					mobileMenu?.classList.remove('opacity-0', 'invisible');
					mobileMenu?.classList.add('opacity-100', 'visible');
				} else {
					mobileMenu?.classList.add('opacity-0', 'invisible');
					mobileMenu?.classList.remove('opacity-100', 'visible');
				}
			});
		}
	}

	customElements.define('header-component', HeaderComponent);
</script>

<style>
	header-component {
		transition:
			padding 0.3s,
			transform 0.3s,
			margin-inline 0.3s,
			border 0.15s,
			background-color 0.15s,
			box-shadow 0.15s;
	}

	header-component a {
		color: rgb(var(--black));
		text-decoration: none;
	}

	header-component a:hover {
		color: var(--accent);
	}

	:global(html.dark) header-component a {
		color: rgb(var(--gray-dark));
	}

	:global(html.dark) header-component a:hover {
		color: var(--accent);
	}

	header-component.not-top {
		background-color: rgba(255, 255, 255, 0.95);
		border-color: rgba(var(--gray), 0.15);
		box-shadow: 0 2px 8px rgba(var(--black), 8%),
					0 8px 16px rgba(var(--black), 5%);
		backdrop-filter: blur(10px);
	}

	:global(html.dark) header-component.not-top {
		background-color: rgba(26, 26, 26, 0.95);
		border-color: rgba(255, 255, 255, 0.1);
		box-shadow: 0 2px 8px rgba(0, 0, 0, 25%),
					0 8px 16px rgba(0, 0, 0, 15%);
	}

	header-component[data-show='false']:not(.expanded) {
		transform: translateY(-5rem);
	}

	@media (min-width: 768px) {
		header-component.not-top {
			margin-inline: 5%;
		}
	}

	@media (min-width: 1024px) {
		header-component.not-top {
			margin-inline: 8%;
		}
	}
</style>
